<memory context_time="2026-02-17T19:45:19Z">
## Known facts

- task → contained → single quote (since 2026-02-17)

## Memory entries

- [2026-02-17 correction] Previously believed screen needed separate prompt templates per classifier. Wrong. One shared template with condition and input XML tags handles all three classifiers. The tuning target is the condition wording, not the template structure.
- [2026-02-17 error] book dispatcher crashed when a task payload contained a single quote. The SQL interpolation in store_result did not escape it. Fixed by running gsub("'", "''") on all user-supplied strings before interpolation.
- [2026-02-17 note] hooker evaluates policies in priority order: gates first, then transforms, then injects. A gate halt stops the chain. Transforms and injects both fire on the same event.
- [2026-02-17 decision] Switched spill from per-tool log files to a single SQLite database. Centralized logging means one place to query when debugging cross-tool failures at 3 AM.
</memory>
